{"version":3,"sources":["video.js","index.js"],"names":["Video","props","elementRef","React","createRef","console","log","this","id","stream","current","srcObject","controls","className","ref","width","height","autoPlay","muted","playsInline","Component","clientId","uuidv4","options","defaultOptions","App","localStream","state","playing","connected","gotRemoteStream","roomId","startVideo","bind","stopVideo","connect","disconnect","handleRoomChange","conn","remoteStream","e","preventDefault","warn","navigator","mediaDevices","getUserMedia","video","audio","then","setState","catch","err","error","getTracks","forEach","track","stop","AyameConnection","on","authzMetadata","handleDisconnect","a","target","value","onClick","disabled","type","onChange","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d7e4a60a.chunk.js","sourcesContent":["import React from 'react';\nimport './video.css';\n\n// ------ Video Component ------\n\nclass Video extends React.Component {\n  constructor(props) {\n    super(props);\n    this.elementRef = React.createRef();\n  }\n\n  componentDidMount() {\n    console.log('Video DidMound(), id=%s', this.props.id);\n  }\n\n  componentWillUnmount() {\n    console.log('Video WillUnmount(), id=%s', this.props.id);\n  }\n\n  render() {\n    console.log('Video render(), id=%s', this.props.id);\n    const stream = this.props.stream;\n    if (this.elementRef.current) {\n      if (this.elementRef.current.srcObject === stream) {\n        console.log('same stream, so skip');\n      }\n      else {\n        this.elementRef.current.srcObject = stream;\n      }\n    }\n    else {\n      console.log('ref.current NULL');\n    }\n\n    const controls = this.props.controls;\n    if (controls) {\n      return (\n        <video className=\"video_with_border\" ref={this.elementRef} id={this.props.id} width={this.props.width} height={this.props.height} autoPlay muted playsInline controls ></video>\n      );\n    }\n    else {\n      return (\n        <video className=\"video_with_border\" ref={this.elementRef} id={this.props.id} width={this.props.width} height={this.props.height} autoPlay muted playsInline ></video>\n      );\n    }\n  }\n}\n\nexport default Video;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Video from './video'; // video.js\nimport { connection as AyameConnection, defaultOptions } from '@open-ayame/ayame-web-sdk';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport './index.css';\n\n// ---- TODO -----\n//  - DONE: roomID (input, url)\n//  - signalingKey (input, url)\n//  - codec (video, audio)\n//  - DONE: button enable/disable control\n//  - DONE: github actions for deploy github pages\n//  - DONE: inline\n//  - volume\n//  - controls\n\n// ------ params -----\nconst signalingUrl = 'wss://ayame-lite.shiguredo.jp/signaling';\nconst signalingKey = null;\nlet roomId = 'mm-react-ayame-test';\nlet clientId = uuidv4(); // â‡¨ '9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d'\n//let videoCodec = null;\n//let audioCodec = null;\n//let signalingKey = null;\n\n// --- Ayame options ---\nconst options = defaultOptions;\noptions.clientId = clientId ? clientId : options.clientId;\nif (signalingKey) {\n  options.signalingKey = signalingKey;\n}\n\n// ------ App class ------\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.localStream = null;\n    this.state = {\n      playing: false,\n      connected: false,\n      gotRemoteStream: false,\n      roomId: roomId,\n    };\n\n    // This binding is necessary to make `this` work in the callback\n    this.startVideo = this.startVideo.bind(this);\n    this.stopVideo = this.stopVideo.bind(this);\n    this.connect = this.connect.bind(this);\n    this.disconnect = this.disconnect.bind(this);\n    this.handleRoomChange = this.handleRoomChange.bind(this);\n\n\n    // -- Ayame connection --\n    this.conn = null;\n    this.remoteStream = null;\n  }\n\n  componentDidMount() {\n    console.log('App DidMound()');\n  }\n\n  componentWillUnmount() {\n    console.log('App WillUnmount()');\n    if (this.localStream) {\n      this.stopVideo();\n    }\n  }\n\n  // -----------\n\n  startVideo(e) {\n    e.preventDefault();\n    console.log('start Video');\n    if (this.localStream) {\n      console.warn('localVideo ALREADY started');\n      return;\n    }\n\n    const constraints = { video: true, audio: true };\n    navigator.mediaDevices.getUserMedia(constraints)\n      .then(stream => {\n        this.localStream = stream;\n        this.setState({ playing: true });\n      })\n      .catch(err => console.error('media ERROR:', err));\n  }\n\n  stopVideo(e) {\n    e.preventDefault();\n    console.log('stop Video');\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => track.stop());\n      this.localStream = null;\n      this.setState({ playing: false });\n    }\n  }\n\n  // -----------------\n  connect(e) {\n    e.preventDefault();\n    console.log('connect');\n\n    if (this.conn) {\n      console.warn('ALREADY connected');\n      return;\n    }\n\n    // (signalingUrl: string, roomId: string, options: ConnectionOptions, debug: boolean, isRelay: boolean)\n    console.log('connecting roomId=%s', this.state.roomId);\n    this.conn = AyameConnection(signalingUrl, this.state.roomId, options);\n    this.conn.on('open', ({ authzMetadata }) => console.log('auth:', authzMetadata));\n    this.conn.on('disconnect', (e) => {\n      console.log('disconnected:', e);\n      this.handleDisconnect();\n    });\n    this.conn.on('addstream', async (e) => {\n      console.log(e.stream);\n      this.remoteStream = e.stream;\n      this.setState({ gotRemoteStream: true });\n    });\n    this.conn.on('removestream', async (e) => {\n      console.log('removestream:', e);\n      this.remoteStream = null;\n      this.setState({ gotRemoteStream: false });\n    });\n    this.conn.connect(this.localStream)\n      .then(() => {\n        console.log('connected');\n        this.setState({ connected: true });\n      })\n      .catch(err => { console.error('connect ERROR:', err) });\n  }\n\n  disconnect(e) {\n    e.preventDefault();\n    console.log('disconnect');\n    this.handleDisconnect();\n  }\n\n  handleDisconnect() {\n    if (this.conn) {\n      this.conn.disconnect();\n      this.conn = null;\n    }\n\n    this.remoteStream = null;\n    this.setState({ connected: false, gotRemoteStream: false });\n  }\n\n  handleRoomChange(e) {\n    this.setState({ roomId: e.target.value });\n  }\n\n  // -----------------\n  render() {\n    console.log('App render()');\n    return (\n      <div className=\"App\" >\n        React Ayame-Lite example<br />\n        <button onClick={this.startVideo} disabled={this.state.playing || this.state.connected}> Start Video</button >\n        <button onClick={this.stopVideo} disabled={!this.state.playing || this.state.connected}>Stop Video</button>\n        <br />\n        Room: <input id=\"room_id\" type=\"text\" value={this.state.roomId} onChange={this.handleRoomChange} disabled={this.state.connected}></input>\n        <button onClick={this.connect} disabled={this.state.connected || !this.state.playing}> Connect</button >\n        <button onClick={this.disconnect} disabled={!this.state.connected}>Disconnect</button>\n        <div className=\"VideoContainer\">\n          <Video id={\"local_video\"} width={\"160px\"} height={\"120px\"} stream={this.localStream}>\n          </Video>\n          <div className=\"RemoteContainer\">\n            <Video id={\"remote_video\"} width={\"320px\"} height={\"240px\"} controls={true} stream={this.remoteStream}>\n            </Video>\n          </div>\n        </div>\n      </div >\n    );\n  }\n}\n\n// ====================== ReactDOM rendering ====================\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}