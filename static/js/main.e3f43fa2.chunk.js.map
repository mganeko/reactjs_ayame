{"version":3,"sources":["video.js","index.js"],"names":["Video","props","elementRef","useRef","console","log","id","stream","volumeValue","volume","current","srcObject","controls","className","ref","width","height","autoPlay","muted","playsInline","signalingKey","keyFromUrl","search","window","location","results","RegExp","exec","key","getKeyFromUrl","roomId","roomFromUrl","room","getRoomFromUrl","clientId","uuidv4","options","defaultOptions","App","localStream","state","playing","connected","gotRemoteStream","videoCodec","startVideo","bind","stopVideo","connect","disconnect","handleRoomChange","handleKeyChange","handleCodecChange","conn","remoteStream","this","e","preventDefault","warn","navigator","mediaDevices","getUserMedia","video","audio","then","setState","catch","err","error","getTracks","forEach","track","stop","codec","AyameConnection","on","authzMetadata","handleDisconnect","a","target","value","onChange","disabled","onClick","type","React","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.e3f43fa2.chunk.js","sourcesContent":["import React, { useRef } from 'react';\nimport './video.css';\n\n// ------ Video Component ------\n\nfunction Video(props) {\n  const elementRef = useRef(null);\n\n  console.log('Video rendering, id=%s', props.id);\n  const stream = props.stream;\n  let volumeValue = 0;\n  if (props.volume) {\n    volumeValue = props.volume;\n  }\n  if (elementRef.current) {\n    if (elementRef.current.srcObject === stream) {\n      console.log('same stream, so skip');\n    }\n    else {\n      elementRef.current.srcObject = stream;\n    }\n\n    elementRef.current.volume = volumeValue;\n  }\n  else {\n    console.log('ref.current NULL');\n  }\n\n  const controls = props.controls;\n  if (controls) {\n    return (\n      <video className=\"video_with_border\" ref={elementRef} id={props.id} width={props.width} height={props.height} autoPlay muted playsInline controls ></video>\n    );\n  }\n  else {\n    return (\n      <video className=\"video_with_border\" ref={elementRef} id={props.id} width={props.width} height={props.height} autoPlay muted playsInline ></video>\n    );\n  }\n}\n\nexport default Video;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Video from './video'; // video.js\nimport { connection as AyameConnection, defaultOptions } from '@open-ayame/ayame-web-sdk';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport './index.css';\n\n// ---- TODO -----\n//  - DONE:roomID (DONE:input, DONE:url)\n//  - DONE: signalingKey (DONE:input, DONE:url)\n//  - DONE: codec (DONE:video, NO:audio)\n//  - DONE: button enable/disable control\n//  - DONE: github actions for deploy github pages\n//  - DONE: inline\n//  - DONE: volume\n//  - DONE: controls\n\n// ------ params -----\nconst signalingUrl = 'wss://ayame-labo.shiguredo.jp/signaling';\nlet signalingKey = null;\nconst keyFromUrl = getKeyFromUrl();\nif (keyFromUrl && (keyFromUrl !== '')) {\n  signalingKey = keyFromUrl;\n}\nlet roomId = 'mm-react-ayame-test';\nconst roomFromUrl = getRoomFromUrl();\nif (roomFromUrl && (roomFromUrl !== '')) {\n  roomId = roomFromUrl;\n}\n\nlet clientId = uuidv4(); // â‡¨ '9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d'\n//let videoCodec = null;\n//let audioCodec = null;\n//let signalingKey = null;\n\n// --- Ayame options ---\nconst options = defaultOptions;\nconsole.log('Ayame default options:', options);\noptions.clientId = clientId ? clientId : options.clientId;\n//if (signalingKey) {\n//  options.signalingKey = signalingKey;\n//}\n\n// ---- URL ----\nfunction getRoomFromUrl() {\n  const search = window.location.search;\n  const re = new RegExp('room=([^&=]+)');\n  const results = re.exec(search);\n  let room = '';\n  if (results) {\n    room = results[1];\n  }\n  return room;\n}\n\nfunction getKeyFromUrl() {\n  const search = window.location.search;\n  const re = new RegExp('key=([^&=]+)');\n  const results = re.exec(search);\n  let key = null;\n  if (results) {\n    key = results[1];\n  }\n  return key;\n}\n\n// ------ App class ------\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.localStream = null;\n    this.state = {\n      playing: false,\n      connected: false,\n      gotRemoteStream: false,\n      roomId: roomId,\n      signalingKey: signalingKey,\n      videoCodec: 'VP9',\n    };\n\n    // This binding is necessary to make `this` work in the callback\n    this.startVideo = this.startVideo.bind(this);\n    this.stopVideo = this.stopVideo.bind(this);\n    this.connect = this.connect.bind(this);\n    this.disconnect = this.disconnect.bind(this);\n    this.handleRoomChange = this.handleRoomChange.bind(this);\n    this.handleKeyChange = this.handleKeyChange.bind(this);\n    this.handleCodecChange = this.handleCodecChange.bind(this);\n\n    // -- Ayame connection --\n    this.conn = null;\n    this.remoteStream = null;\n  }\n\n  componentDidMount() {\n    console.log('App DidMound()');\n  }\n\n  componentWillUnmount() {\n    console.log('App WillUnmount()');\n    if (this.localStream) {\n      this.stopVideo();\n    }\n  }\n\n  // -----------\n\n  startVideo(e) {\n    e.preventDefault();\n    console.log('start Video');\n    if (this.localStream) {\n      console.warn('localVideo ALREADY started');\n      return;\n    }\n\n    const constraints = { video: true, audio: true };\n    navigator.mediaDevices.getUserMedia(constraints)\n      .then(stream => {\n        this.localStream = stream;\n        this.setState({ playing: true });\n      })\n      .catch(err => console.error('media ERROR:', err));\n  }\n\n  stopVideo(e) {\n    e.preventDefault();\n    console.log('stop Video');\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => track.stop());\n      this.localStream = null;\n      this.setState({ playing: false });\n    }\n  }\n\n  // -----------------\n  connect(e) {\n    e.preventDefault();\n    console.log('connect');\n\n    if (this.conn) {\n      console.warn('ALREADY connected');\n      return;\n    }\n\n    if (this.state.signalingKey && (this.state.signalingKey !== '')) {\n      options.signalingKey = this.state.signalingKey;\n    }\n\n    options.video.codec = this.state.videoCodec;\n\n    // (signalingUrl: string, roomId: string, options: ConnectionOptions, debug: boolean, isRelay: boolean)\n    console.log('connecting roomId=%s key=%s', this.state.roomId, options.signalingKey);\n    console.log('Ayame connect options:', options);\n    this.conn = AyameConnection(signalingUrl, this.state.roomId, options);\n    this.conn.on('open', ({ authzMetadata }) => console.log('auth:', authzMetadata));\n    this.conn.on('disconnect', (e) => {\n      console.log('disconnected:', e);\n      this.handleDisconnect();\n    });\n    this.conn.on('addstream', async (e) => {\n      console.log(e.stream);\n      this.remoteStream = e.stream;\n      this.setState({ gotRemoteStream: true });\n    });\n    this.conn.on('removestream', async (e) => {\n      console.log('removestream:', e);\n      this.remoteStream = null;\n      this.setState({ gotRemoteStream: false });\n    });\n    this.conn.connect(this.localStream)\n      .then(() => {\n        console.log('connected');\n        this.setState({ connected: true });\n      })\n      .catch(err => { console.error('connect ERROR:', err) });\n  }\n\n  disconnect(e) {\n    e.preventDefault();\n    console.log('disconnect');\n    this.handleDisconnect();\n  }\n\n  handleDisconnect() {\n    if (this.conn) {\n      this.conn.disconnect();\n      this.conn = null;\n    }\n\n    this.remoteStream = null;\n    this.setState({ connected: false, gotRemoteStream: false });\n  }\n\n  handleRoomChange(e) {\n    this.setState({ roomId: e.target.value });\n  }\n\n  handleKeyChange(e) {\n    this.setState({ signalingKey: e.target.value });\n  }\n\n  handleCodecChange(e) {\n    this.setState({ videoCodec: e.target.value });\n  }\n\n  // -----------------\n  render() {\n    console.log('App render()');\n    return (\n      <div className=\"App\" >\n        React Ayame-Lite example<br />\n        Video Codec:\n        <select value={this.state.videoCodec} onChange={this.handleCodecChange} disabled={this.state.connected} >\n          <option value=\"VP8\">VP8</option>\n          <option value=\"VP9\">VP9</option>\n          <option value=\"H264\">H264</option>\n        </select>\n        &nbsp;\n        <button onClick={this.startVideo} disabled={this.state.playing || this.state.connected}> Start Video</button >\n        <button onClick={this.stopVideo} disabled={!this.state.playing || this.state.connected}>Stop Video</button>\n        <br />\n        SignalingKey: <input id=\"signaling_key\" type=\"text\" value={this.state.signalingKey} onChange={this.handleKeyChange} disabled={this.state.connected}></input>\n        <br />\n        Room: <input id=\"room_id\" type=\"text\" value={this.state.roomId} onChange={this.handleRoomChange} disabled={this.state.connected}></input>\n        <button onClick={this.connect} disabled={this.state.connected || !this.state.playing}> Connect</button >\n        <button onClick={this.disconnect} disabled={!this.state.connected}>Disconnect</button>\n        <div className=\"VideoContainer\">\n          <Video id={\"local_video\"} width={\"160px\"} height={\"120px\"} stream={this.localStream}>\n          </Video>\n          <div className=\"RemoteContainer\">\n            <Video id={\"remote_video\"} width={\"320px\"} height={\"240px\"} volume={0.5} controls={true} stream={this.remoteStream}>\n            </Video>\n          </div>\n        </div>\n      </div >\n    );\n  }\n}\n\n// ====================== ReactDOM rendering ====================\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}